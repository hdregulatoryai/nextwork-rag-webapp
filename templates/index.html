<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HD Regulatory AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --panel: #ffffff; --ink: #1a1a1a; --muted: #555;
      --accent: #00b7ff; --accent-2: #7f5af0;
      --radius: 14px; --border: 1px solid rgba(0,0,0,0.08);
      --shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    * { box-sizing: border-box; }
    body {
      margin:0; font-family:'Inter',sans-serif; color:var(--ink); min-height:100vh;
      background:#f2f2f2;
      background-image:
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="240" height="240"><g fill="none" stroke="rgba(0,183,255,0.05)" stroke-width="1"><rect x="20" y="20" width="200" height="200" rx="12"/><circle cx="120" cy="120" r="80"/></g></svg>'),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160"><g fill="none" stroke="rgba(127,90,240,0.05)" stroke-width="2"><rect x="20" y="40" width="120" height="80" rx="6"/><line x1="40" y1="40" x2="40" y2="120"/><line x1="80" y1="40" x2="80" y2="120"/></g></svg>');
      background-repeat:repeat,repeat; background-size:260px 260px,200px 200px; background-attachment:fixed;
    }
    main {
      max-width:960px; margin:40px auto; padding:24px; background:#fff;
      border-radius:var(--radius); box-shadow:var(--shadow);
    }
    h1 { font-size:34px; margin-bottom:12px; color:var(--accent-2); }
    h2 { margin-top:28px; font-size:22px; color:var(--accent); }
    h3 { margin-top:20px; font-size:18px; display:flex; align-items:center; gap:8px; margin-left:20px; }
    h3 svg { width:18px; height:18px; flex-shrink:0; }
    ul { padding-left:40px; margin-top:8px; }
    li { line-height:1.55; color:var(--muted); margin-bottom:8px; }
    strong { color:var(--ink); }

    /* Floating Chat Widget */
    .chat-widget {
      position:fixed; bottom:20px; right:20px; width:360px; max-height:70vh;
      display:flex; flex-direction:column; background:#ffffff; border:var(--border);
      border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; z-index:50;
    }
    .chat-top {
      padding:12px 14px; border-bottom:var(--border); display:flex; justify-content:space-between; align-items:center;
      font-size:14px; font-weight:600; background:linear-gradient(90deg, var(--accent-2), var(--accent)); color:#fff;
    }
    .stream { flex:1; padding:12px; overflow:auto; display:flex; flex-direction:column; gap:10px; }
    .msg { border-radius:12px; padding:10px 12px; line-height:1.4; max-width:90%; word-wrap:break-word; }
    .user { align-self:flex-end; background:rgba(0,183,255,0.15); }
    .bot { align-self:flex-start; background:rgba(127,90,240,0.08); }
    .time { display:block; font-size:10px; color:var(--muted); margin-top:4px; }
    .typing { display:inline-flex; gap:6px; }
    .dot { width:7px; height:7px; border-radius:50%; background:rgba(0,0,0,0.5); animation:bounce 1.35s infinite; }
    .dot:nth-child(2){ animation-delay:-.2s } .dot:nth-child(3){ animation-delay:-.4s }
    @keyframes bounce{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-6px)}}
    .input { display:flex; padding:10px; border-top:var(--border); gap:6px; background:#fafafa; }
    .field { flex:1; background:#fff; border:var(--border); border-radius:10px; padding:6px 10px; }
    .field input { width:100%; border:none; outline:none; background:transparent; color:var(--ink); }
    .send { background:linear-gradient(90deg, var(--accent-2), var(--accent)); border:none; border-radius:10px; color:#fff; padding:0 14px; font-weight:600; cursor:pointer; }
    .send[disabled]{opacity:.6;cursor:not-allowed}
    .err { position:fixed; bottom:100px; right:20px; background:#ffd6d6; color:#a60000; border:1px solid rgba(200,0,0,0.4); padding:8px 12px; border-radius:8px; font-size:12px; display:none; z-index:99; }
    .err.show { display:block; }

    /* Sources + Attributions styling */
    .sources { margin-top:8px; display:flex; flex-wrap:wrap; gap:6px; }
    .pill {
      display:inline-flex; align-items:center; gap:6px;
      padding:4px 8px; font-size:12px; border-radius:999px;
      border:1px solid rgba(0,0,0,0.08); background:#fff;
    }
    .pill svg { width:14px; height:14px; }
    .attr-wrap { margin-top:8px; }
    .attr-toggle {
      background:transparent; border:none; color:var(--accent-2); font-size:12px; cursor:pointer; padding:0;
      text-decoration:underline;
    }
    .attr-list { display:none; margin-top:8px; display:flex; flex-direction:column; gap:8px; }
    .attr-card {
      background:#fff; border:1px solid rgba(0,0,0,0.08); border-radius:10px; padding:8px;
    }
    .attr-card .line { font-size:12px; color:var(--muted); }
    .attr-card .line strong { color:var(--ink); }
    .attr-card code { font-size:12px; background:#f6f6f6; padding:2px 4px; border-radius:6px; }
    .hidden { display:none !important; }

    /* ===== Feedback modal (added) ===== */
    .fb-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:60}
    .fb-show{display:flex!important}
    .fb-modal{width:100%;max-width:520px;background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.15);overflow:hidden;border:1px solid rgba(0,0,0,.08)}
    .fb-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid rgba(0,0,0,.08);background:#fafafa}
    .fb-head h4{margin:0;font-size:16px}
    .fb-body{padding:14px;display:flex;flex-direction:column;gap:10px}
    .fb-row label{display:block;font-size:13px;margin-bottom:6px;color:#333}
    .fb-row select,.fb-row textarea,.fb-row input[type="email"],.fb-row input[type="file"]{width:100%;font-family:inherit;padding:8px;border:1px solid rgba(0,0,0,.15);border-radius:10px}
    .fb-actions{display:flex;gap:10px;justify-content:flex-end;padding:12px 14px;border-top:1px solid rgba(0,0,0,.08);background:#fafafa}
    .fb-btn{border:none;border-radius:10px;padding:8px 14px;font-weight:600;cursor:pointer}
    .fb-cancel{background:#eee;color:#333}
    .fb-submit{background:linear-gradient(90deg,#7f5af0,#00b7ff);color:#fff}
    .fb-toast{position:fixed;bottom:100px;right:20px;background:#e8f7ee;color:#0a5e2a;border:1px solid rgba(10,94,42,.3);padding:8px 12px;border-radius:8px;font-size:12px;display:none;z-index:99}
  </style>
</head>
<body>
  <main>
    <h1>⚖️ HD Regulatory AI</h1>

    <!-- (content unchanged for brevity) -->
    <h2>Advantage of HD Regulatory AI</h2>
    <h3><svg xmlns="http://www.w3.org/2000/svg" fill="green" viewBox="0 0 20 20"><path d="M10 2l6 3v5c0 5-3 9-6 10-3-1-6-5-6-10V5l6-3z"/><path d="M9 11l-2-2 1.5-1.5L9 8.5l3.5-3.5L14 6l-5 5z" fill="white"/></svg>Improved Factual Accuracy & Reduced Hallucinations</h3>
    <ul>
      <li>Responses are grounded in a source of truth eliminating hallucinations, inaccurate opinions, or outdated intelligence.</li>
      <li>Tailored for regulatory affairs and product development SMEs.</li>
      <li>The model understands complex legal language and provides precise answers.</li>
      <li>Ability to use LLM directly in the same interface by checking the “Direct AI” box.</li>
    </ul>

    <h3><svg xmlns="http://www.w3.org/2000/svg" fill="blue" viewBox="0 0 20 20"><path d="M10 2a8 8 0 106.32 3.16l1.38 1.44V2h-4l1.44 1.44A6 6 0 1110 4a6 6 0 015.19 3H14v2h6V3h-2v3.09A8 8 0 0010 2z"/></svg>Access to Up-To-Date & Proprietary Information</h3>
    <ul><li>Continuously updated with the latest regulations, guidance, and policies to ensure accuracy for compliance.</li></ul>

    <h3><svg xmlns="http://www.w3.org/2000/svg" fill="gold" viewBox="0 0 20 20"><path d="M11 0L1 12h7v8l11-14h-7V0z"/></svg>Increased Efficiency & Productivity</h3>
    <ul><li>Relevant, concise, cited answers increase efficiency and accelerate decision making.</li></ul>

    <h3><svg xmlns="http://www.w3.org/2000/svg" fill="purple" viewBox="0 0 20 20"><path d="M4 2h8l4 4v12a2 2 0 01-2 2H4a2 2 0 01-2-2V4a2 2 0 012-2z"/><path d="M7.5 12.5L9.5 14.5 13 11"/></svg>Traceability & Accountability</h3>
    <ul><li>Verifiable sources increase transparency and trust for health authority interactions and product registration.</li></ul>

    <h2>What can HD Regulatory AI do for you?</h2>
    <ul>
      <li>Provide a dedicated space for gathering most relevant regulatory intelligence.</li>
      <li>Customize the space for organizations of any size by incorporating product-specific information and health authority feedback.</li>
      <li>Offer professional support on interpretation of laws/regulations and assisting with product development.</li>
    </ul>

    <h2>Contact</h2>
    <p>For questions, suggestions, chat demo, or collaboration opportunities, please send email to:
      <a href="mailto:contact@HDRegAI.com">contact@HDRegAI.com</a>
    </p>
  </main>

  <!-- Floating Chat Widget -->
  <div class="chat-widget">
    <div class="chat-top">
      <span>Ask HD Reg AI</span>
      <label style="font-size:12px;font-weight:normal;display:flex;align-items:center;gap:4px;color:#fff;">
        <input type="checkbox" id="knowledgeBaseToggle" /> Direct AI
      </label>
    </div>
    <div id="chatMessages" class="stream"></div>
    <div class="input">
      <div class="field"><input id="messageInput" type="text" placeholder="Type your question…"/></div>
      <button id="sendButton" class="send">Send</button>
    </div>
  </div>

  <div id="toast" class="err">Sorry, something went wrong.</div>

  <!-- ===== Feedback CTA (footer) ===== -->
  <footer style="max-width:960px;margin:16px auto 40px;padding:0 24px;color:#333">
    For any issue with the chatbot (inaccuracy, missing intelligence), please provide your
    <a id="openFeedback" style="color:#7f5af0;text-decoration:underline;cursor:pointer">feedback</a>.
  </footer>

  <!-- ===== Feedback Modal (Netlify Forms) ===== -->
  <div id="fbToast" class="fb-toast">Thanks! Your feedback was sent.</div>

  <div id="fbModal" class="fb-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="fb-modal">
      <div class="fb-head">
        <h4>Submit Feedback</h4>
        <button id="fbClose" class="fb-btn fb-cancel" aria-label="Close">Close</button>
      </div>

      <!-- Netlify will detect this form after first deploy -->
      <form id="fbForm" class="fb-body"
            name="feedback"
            method="POST"
            action="/success.html"
            enctype="multipart/form-data"
            data-netlify="true"
            netlify
            data-netlify-honeypot="bot-field">
        <!-- Required hidden field for AJAX submissions -->
        <input type="hidden" name="form-name" value="feedback" />
        <p style="display:none">
          <label>Don’t fill this out: <input name="bot-field" /></label>
        </p>

        <div class="fb-row">
          <label for="fbIssue">Issue type</label>
          <select id="fbIssue" name="issue" required>
            <option>Inaccurate Responses</option>
            <option>Missing Intelligence</option>
            <option>Other Issue</option>
          </select>
        </div>

        <div class="fb-row">
          <label for="fbShot">Screenshot (optional) — paste or upload a file</label>
          <input id="fbShot" type="file" name="screenshot" accept="image/*" />
        </div>

        <div class="fb-row">
          <label for="fbNotes">Notes / contact (optional)</label>
          <textarea id="fbNotes" name="notes" placeholder="Describe the issue; include an email if you’d like a reply." rows="5"></textarea>
        </div>

        <div class="fb-row">
          <label for="fbEmail">Reply-to email (optional)</label>
          <input id="fbEmail" type="email" name="email" placeholder="you@example.com" />
        </div>

        <div class="fb-actions">
          <button type="button" id="fbCancel" class="fb-btn fb-cancel">Cancel</button>
          <button type="submit" class="fb-btn fb-submit">Submit</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    (function () {
      // ===== DOM refs (declare ONCE) =====
      const messageInput = document.getElementById('messageInput');
      const sendButton = document.getElementById('sendButton');
      const chatMessages = document.getElementById('chatMessages');
      const knowledgeBaseToggle = document.getElementById('knowledgeBaseToggle');
      const toast = document.getElementById('toast');
  
      // ✅ Point to your API domain in production, localhost in dev
      const API_BASE = (window.location.hostname.includes('localhost') || window.location.hostname.includes('127.0.0.1'))
        ? 'http://127.0.0.1:8000'
        : 'https://api.hdregai.com';
  
      function nowTime() {
        return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      }
  
      function addMessage(text, isUser=false, isLoading=false) {
        const wrap = document.createElement('div');
        wrap.className = 'msg ' + (isUser ? 'user' : 'bot');
        if (isLoading) {
          wrap.innerHTML = '<div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div><span class="time">'+nowTime()+'</span>';
        } else {
          const p = document.createElement('div');
          p.textContent = text;
          wrap.appendChild(p);
          const t = document.createElement('span');
          t.className = 'time';
          t.textContent = nowTime();
          wrap.appendChild(t);
        }
        chatMessages.appendChild(wrap);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        return wrap;
      }
  
      function addSourcesAndAttributions(parentEl, sources, attributions) {
        if (Array.isArray(sources) && sources.length) {
          const srcWrap = document.createElement('div');
          srcWrap.className = 'sources';
          sources.forEach(name => {
            const pill = document.createElement('span');
            pill.className = 'pill';
            pill.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2 2h8l4 4v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" fill="currentColor"/></svg>
              ${name}
            `;
            srcWrap.appendChild(pill);
          });
          parentEl.appendChild(srcWrap);
        }
  
        if (Array.isArray(attributions) && attributions.length) {
          const attrWrap = document.createElement('div');
          attrWrap.className = 'attr-wrap';
  
          const toggle = document.createElement('button');
          toggle.className = 'attr-toggle';
          toggle.textContent = 'Show attribution details';
          attrWrap.appendChild(toggle);
  
          const list = document.createElement('div');
          list.className = 'attr-list hidden';
  
          attributions.forEach((a, i) => {
            const card = document.createElement('div');
            card.className = 'attr-card';
            const filename = a?.filename || '(unknown)';
            const uri = a?.uri || '';
            const score = (a?.score !== undefined && a?.score !== null) ? ` — score: ${Number(a.score).toFixed(3)}` : '';
            const snippet = a?.snippet ? a.snippet : '';
            card.innerHTML = `
              <div class="line"><strong>${i+1}. ${filename}</strong>${score}</div>
              ${uri ? `<div class="line"><a href="${uri}" target="_blank" rel="noopener">Open source</a></div>` : ''}
              ${snippet ? `<div class="line"><code>${escapeHtml(truncate(snippet, 420))}</code></div>` : ''}
            `;
            list.appendChild(card);
          });
  
          toggle.addEventListener('click', () => {
            const isHidden = list.classList.contains('hidden');
            list.classList.toggle('hidden');
            toggle.textContent = isHidden ? 'Hide attribution details' : 'Show attribution details';
          });
  
          attrWrap.appendChild(list);
          parentEl.appendChild(attrWrap);
        }
      }
  
      function escapeHtml(s) {
        return String(s)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      }
      function truncate(s, n) {
        return s && s.length > n ? s.slice(0, n - 1) + '…' : s;
      }
  
      function showToast(msg) {
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2500);
      }
  
      async function sendMessage() {
        const text = (messageInput.value || '').trim();
        if (!text) return;
        const isDirect = knowledgeBaseToggle.checked; // Direct AI = /bedrock/invoke
        addMessage(text, true);
        messageInput.value = '';
        const loading = addMessage('', false, true);
        sendButton.disabled = true;
  
        const endpoint = isDirect ? `${API_BASE}/bedrock/invoke` : `${API_BASE}/bedrock/query`;
        try {
          const res = await fetch(`${endpoint}?text=${encodeURIComponent(text)}`);
          if (!res.ok) {
            const errText = await res.text();
            throw new Error(errText || 'HTTP error ' + res.status);
          }
          const data = await res.json();
          loading.remove();
  
          const botMsg = addMessage(data.response || '…', false, false);
          if (Array.isArray(data.sources) || Array.isArray(data.attributions)) {
            addSourcesAndAttributions(botMsg, data.sources || [], data.attributions || []);
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }
        } catch (err) {
          console.error(err);
          loading.remove();
          addMessage('Something went wrong.');
          showToast('Network error. Please try again.');
        } finally {
          sendButton.disabled = false;
        }
      }
  
      // ===== Feedback modal logic =====
      const openBtn = document.getElementById('openFeedback');
      const modal   = document.getElementById('fbModal');
      const closeBtn= document.getElementById('fbClose');
      const cancel  = document.getElementById('fbCancel');
      const fbToast = document.getElementById('fbToast');
      const fbForm  = document.getElementById('fbForm');
  
      function fbOpen(){ if(modal){ modal.classList.add('fb-show'); modal.setAttribute('aria-hidden','false'); } }
      function fbClose(){ if(modal && fbForm){ modal.classList.remove('fb-show'); modal.setAttribute('aria-hidden','true'); fbForm.reset(); } }
      function fbToastShow(msg){ if(fbToast){ fbToast.textContent = msg || 'Thanks! Your feedback was sent.'; fbToast.style.display='block'; setTimeout(()=>fbToast.style.display='none', 2500); } }
  
      if (openBtn) openBtn.addEventListener('click', (e)=>{ e.preventDefault(); fbOpen(); });
      if (closeBtn) closeBtn.addEventListener('click', fbClose);
      if (cancel) cancel.addEventListener('click', fbClose);
      if (modal) modal.addEventListener('click', (e)=>{ if(e.target===modal) fbClose(); });
  
      // AJAX submit to Netlify Forms (supports file upload via FormData)
      /*
      if (fbForm) fbForm.addEventListener('submit', async (e)=>{
        e.preventDefault();
        try {
          const formData = new FormData(fbForm);
          formData.set('form-name', 'feedback'); // ensure Netlify captures this form
          const res = await fetch('/', { method: 'POST', body: formData });
          if (!res.ok) throw new Error('Network error');
          fbClose();
          fbToastShow('Thanks! Your feedback was sent.');
        } catch (err) {
          console.error(err);
          fbToastShow('Could not send feedback. Please try again.');
        }
      });
  
      // Chat handlers
      sendButton.addEventListener('click', sendMessage);
      messageInput.addEventListener('keydown', e => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault(); sendMessage();
        }
      });
      */
  
      addMessage('Hi! Ask me about statutes, rules, or compliance scenarios.', false, false);
    })();
  </script>  
</body>
</html>
